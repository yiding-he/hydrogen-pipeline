# hydrogen-pipeline
A design pattern for pipeline processing.

```
          ┌───┐      ┌───┐      ┌───┐
          │   │      │   │      │   │
  call────► A ├──────► B ├──────► C │
          │   │      │   │      │   │
          └───┘      └───┘      └───┘

  1. Prepare phase  ───────────────►
  2. Plan phase     ◄───────────────
  3. Process phase  ───────────────►

```

这是一个以三阶段来进行管道处理的设计模式。

我们通常使用管道的方式来执行流程节点的处理，前一个节点完成再执行下一个节点，最后一个节点执行完将得到输出结果。

但是在某些场景下，比如最后一个节点是可以缓存结果的，那么前面几个节点就不需要执行了。

也就是说，前面的节点是否要执行，由后面的节点来决定。

为了满足这样的场景，一般我们一般是这么设计的：

```

  ┌───┐      ┌───┐      ┌───┐
  │   │      │   │      │   │
  │   ◄──────┤   ◄──────┤   ◄────call
  │   │      │   │      │   │
  │ A │      │ B │      │ C │
  │   │      │   │      │   │
  │   ├──────►   ├──────►   │
  │   │      │   │      │   │
  └───┘      └───┘      └───┘

  如果 C 知道自己缓存了结果，则不会调用 B，而直接返回。同理，B 不一定会调用 A。

```

这么做有个问题是，如果 C 需要 A 提供一些信息的话，就做不到了。

所以一种更合理的方式是这样：

```

          ┌───┐      ┌───┐      ┌───┐
          │   │      │   │      │   │
  call────► A ├──────► B ├──────► C │ 1. Prepare phase
          │   │      │   │      │   │
          │   │      │   │      │   │
          │   ◄──────┤   ◄──────┤   │ 2. Plan phase
          │   │      │   │      │   │
          │   │      │   │      │   │
          │   ├──────►   ├──────►   │ 3. Process phase
          │   │      │   │      │   │
          └───┘      └───┘      └───┘

```

整个过程分为三个阶段：

- **准备阶段**（Prepare Phase）：创建一个 Context 对象，每个节点向 Context 对象填充信息，然后将其向后传递直到最后一个节点；
- **计划阶段**（Plan Phase）：创建一个 Plan 对象，从最后一个节点开始，根据自身需要向其中填充上一个节点。
- **处理阶段**（Process Phase）：根据生成的 Plan 内容按顺序执行节点。

